import{createClient as b}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/+esm";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const P="https://pklaygtgyryexuyykvtf.supabase.co",A="sb_publishable_9Md4POoW2KwD-RgFZRy8XQ_UuWu-wjE",i=b(P,A),T="K85308176588957",U="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",x="pk_test_c8085f6e5ec5f58ab4146937afe3daf700003bfe";document.addEventListener("DOMContentLoaded",function(){_()});async function _(){i.auth.onAuthStateChange(async(e,n)=>{e==="SIGNED_IN"&&n?v():e==="SIGNED_OUT"&&w()});const{data:{user:t}}=await i.auth.getUser();t?v():w(),F()}function F(){document.getElementById("authBtn").addEventListener("click",k);const t=document.getElementById("fileUpload"),e=document.getElementById("imageUpload");t&&t.addEventListener("change",q),e&&e.addEventListener("change",C);const n=document.getElementById("uploadArea"),r=document.getElementById("imageUploadArea");n&&n.addEventListener("click",()=>document.getElementById("fileUpload").click()),r&&r.addEventListener("click",()=>document.getElementById("imageUpload").click());const a=document.getElementById("processFileBtn");a&&a.addEventListener("click",O);const o=document.getElementById("extractTextBtn");o&&o.addEventListener("click",M);const s=document.getElementById("recordBtn");s&&s.addEventListener("click",N);const c=document.getElementById("generateBtn");c&&c.addEventListener("click",$);const f=document.getElementById("saveTranscriptBtn");f&&f.addEventListener("click",R),document.querySelectorAll(".plan-btn.primary, .plan-btn.secondary").forEach(d=>{d.addEventListener("click",G)});const g=document.getElementById("intaSendButton");g&&g.addEventListener("click",H);const p=document.querySelectorAll(".nav-link");p.forEach(d=>{d.addEventListener("click",function(B){B.preventDefault(),p.forEach(u=>u.classList.remove("active")),document.querySelectorAll(".tab-pane").forEach(u=>u.classList.remove("active")),this.classList.add("active");const S=this.dataset.tab;document.getElementById(`${S}-tab`).classList.add("active")})});const h=document.querySelector(".cta-primary"),y=document.querySelector(".cta-secondary");h&&h.addEventListener("click",()=>{document.getElementById("generate-tab").scrollIntoView({behavior:"smooth"})}),y&&y.addEventListener("click",()=>{alert("Demo video would play here in the full version.")})}async function k(){const{data:{user:t}}=await i.auth.getUser();if(t){const{error:e}=await i.auth.signOut();e&&console.error("Error signing out:",e)}else m()}async function q(t){const e=t.target.files[0];e&&(document.getElementById("fileName").textContent=e.name,document.getElementById("filePreview").classList.remove("hidden"))}async function O(){const e=document.getElementById("fileUpload").files[0];if(!e){alert("Please select a file first.");return}try{const n=await D(e);document.querySelector(".notes-input").value=n}catch(n){console.error("Error reading file:",n),alert("Failed to read file. Please try again.")}}async function C(t){const e=t.target.files[0];if(!e)return;const n=document.getElementById("previewImage");n.src=URL.createObjectURL(e),document.getElementById("imagePreview").classList.remove("hidden")}async function M(){const e=document.getElementById("imageUpload").files[0];if(!e){alert("Please select an image first.");return}try{L("Extracting text from image...");const n=await z(e);document.querySelector(".notes-input").value=n,l()}catch(n){console.error("Error extracting text:",n),l(),alert("Failed to extract text from image. Please try again.")}}async function N(){const t=document.getElementById("recordBtn"),e=document.querySelector(".recording-status"),n=document.querySelector(".voice-actions");t.classList.toggle("recording"),t.classList.contains("recording")?(t.innerHTML='<i class="ri-stop-fill"></i> Stop Recording',e&&e.classList.remove("hidden"),n&&n.classList.remove("hidden"),setTimeout(()=>{const r=document.getElementById("transcriptPreview");r&&(r.textContent="This is a simulated transcript of your voice recording. In the full version, this would be actual speech-to-text transcription.")},2e3)):(t.innerHTML='<i class="ri-mic-fill"></i> Start Recording',e&&e.classList.add("hidden"))}async function R(){const t=document.getElementById("transcriptPreview").textContent;document.querySelector(".notes-input").value=t}async function $(){const t=document.querySelector(".notes-input").value;if(!t.trim()){alert("Please enter some text or upload content first.");return}try{L("Generating flashcards...");const e=await K(t);j(e),l()}catch(e){console.error("Error generating flashcards:",e),l(),alert("Failed to generate flashcards. Please try again.")}}function j(t){const e=document.getElementById("flashcardsGrid");e&&(e.innerHTML="",t.forEach((n,r)=>{const a=document.createElement("div");a.className="flashcard",a.innerHTML=`
      <div class="flashcard-content">
        <h4>Card ${r+1}</h4>
        <p><strong>Q:</strong> ${n.question}</p>
        <p><strong>A:</strong> ${n.answer}</p>
      </div>
    `,e.appendChild(a)}),document.getElementById("resultsSection").classList.remove("hidden"))}async function G(t){t.preventDefault();const{data:{user:e}}=await i.auth.getUser();if(!e){alert("Please sign in to upgrade to premium."),m();return}const n=t.target.closest(".pricing-card").classList.contains("premium")?"monthly":"yearly";try{await I(e.id,n)}catch(r){console.error("Premium upgrade error:",r),alert("Failed to initialize payment. Please try again.")}}async function H(){const{data:{user:t}}=await i.auth.getUser();if(!t){alert("Please sign in to upgrade to premium."),m();return}try{await I(t.id,"monthly")}catch(e){console.error("Payment error:",e),alert("Failed to initialize payment. Please try again.")}}function D(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=a=>e(a.target.result),r.onerror=a=>n(r.error),r.readAsText(t)})}async function z(t){const e=new FormData;e.append("file",t),e.append("apikey",T),e.append("language","eng"),e.append("isOverlayRequired","false");try{const r=await(await fetch("https://api.ocr.space/parse/image",{method:"POST",body:e})).json();if(r.IsErroredOnProcessing)throw new Error(r.ErrorMessage.join(", "));return r.ParsedResults[0].ParsedText}catch(n){throw console.error("OCR Error:",n),new Error("Failed to extract text from image")}}async function K(t){try{const n=await(await fetch("https://api-inference.huggingface.co/models/google/flan-t5-large",{headers:{Authorization:`Bearer ${U}`},method:"POST",body:JSON.stringify({inputs:`Generate flashcard questions and answers from the following text. Format as JSON: [{"question": "Q1", "answer": "A1"}, {"question": "Q2", "answer": "A2"}]. Text: ${t.substring(0,1e3)}`})})).json();if(n.error)throw new Error(n.error);const r=n[0].generated_text.match(/\[.*\]/s);return r?JSON.parse(r[0]):E(t)}catch(e){return console.error("Hugging Face API Error:",e),E(t)}}function E(t){const e=t.split(/[.!?]/).filter(r=>r.length>10),n=[];for(let r=0;r<Math.min(e.length,5);r++){const a=e[r].trim();if(a.length<15)continue;const o=a.split(" ");if(o.length<4)continue;const s=Math.floor(o.length/2),c=o[s];o[s]="______",n.push({question:o.join(" ")+"?",answer:c})}return n}async function I(t,e){try{const{data:{user:n}}=await i.auth.getUser();if(!n)throw new Error("User not authenticated");const r=e==="monthly"?900:1900,o=await(await fetch("https://api.paystack.co/transaction/initialize",{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify({email:n.email,amount:r*100,metadata:{userId:t,planType:e},callback_url:`${window.location.origin}/payment-verification.html`})})).json();if(!o.status)throw new Error(o.message);window.location.href=o.data.authorization_url}catch(n){throw console.error("Premium upgrade error:",n),new Error("Failed to initialize payment")}}function L(t="Loading..."){const e=document.getElementById("loadingState");e&&(e.querySelector("p").textContent=t,e.classList.remove("hidden"))}function l(){const t=document.getElementById("loadingState");t&&t.classList.add("hidden")}function m(){alert("Auth modal would appear here. In a full implementation, this would show a login/signup form.")}function v(){const t=document.getElementById("authBtn");t&&(t.innerHTML='<i class="ri-user-line"></i> Sign Out'),Y(),J()}function w(){const t=document.getElementById("authBtn");t&&(t.innerHTML='<i class="ri-user-line"></i> Sign In')}async function Y(){try{const{data:{user:t}}=await i.auth.getUser();if(!t)return null;const{data:e,error:n}=await i.from("profiles").select("*").eq("id",t.id).single();if(n)throw n;return e&&e.is_premium&&document.querySelectorAll(".premium-only").forEach(r=>{r.classList.remove("hidden")}),e}catch(t){console.error("Error loading user data:",t)}}async function J(){try{const{data:{user:t}}=await i.auth.getUser();if(!t)return;const{data:e,error:n}=await i.from("study_sets").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(n)throw n;Q(e)}catch(t){console.error("Error loading study sets:",t)}}function Q(t){const e=document.getElementById("setsGrid");if(e){if(!t||t.length===0){e.innerHTML=`
      <div class="empty-state">
        <div class="empty-icon">
          <i class="ri-folder-open-line"></i>
        </div>
        <h3>No Study Sets Yet</h3>
        <p>Create your first study set to get started with learning!</p>
        <button class="empty-cta" onclick="switchToTab('generate')">
          <i class="ri-add-line"></i>
          Create First Set
        </button>
      </div>
    `;return}e.innerHTML="",t.forEach(n=>{const r=document.createElement("div");r.className="study-set-card",r.innerHTML=`
      <div class="set-header">
        <h3>${n.title}</h3>
        <span class="set-subject">${n.subject||"General"}</span>
      </div>
      <div class="set-content">
        <p>${n.description||"No description available."}</p>
      </div>
      <div class="set-footer">
        <span class="card-count">${n.card_count||0} cards</span>
        <button class="study-set-btn">Study Now</button>
      </div>
    `,e.appendChild(r)})}}function Z(t){document.querySelectorAll(".nav-link").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-pane").forEach(e=>e.classList.remove("active")),document.querySelector(`[data-tab="${t}"]`).classList.add("active"),document.getElementById(`${t}-tab`).classList.add("active")}window.switchToTab=Z;
